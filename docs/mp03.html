<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="rahicodes">

<title>Mini-Project 03 – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-cd7454b418030687c631a6a7286fbe16.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-eca17b5da0ebcb32698e5dfc46a04a8c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project 03</h1>
<p class="subtitle lead">Visualizing and Maintaining the Green Canopy of NYC</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>rahicodes </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Trees play a vital role in New York City’s environmental health, economic vitality, and residents’ overall quality of life. With over 900,000 street trees distributed across the five boroughs, the NYC Parks Department is responsible for their care and maintenance. Ensuring that every neighborhood benefits equally from this urban canopy requires thoughtful planning and investment.</p>
<p>This project examines how street trees are distributed across City Council districts to identify areas that may be underserved. The analysis aims to highlight districts where targeted tree-planting initiatives could promote greater environmental equity and enhance the city’s overall green infrastructure.</p>
</section>
<section id="data-acquisition" class="level1">
<h1>Data Acquisition</h1>
<section id="nyc-city-council-districts" class="level3">
<h3 class="anchored" data-anchor-id="nyc-city-council-districts">NYC City Council Districts</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended project data directory</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>dir_mp03 <span class="ot">&lt;-</span> <span class="st">"data/mp03"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_create</span>(dir_mp03)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="task-1-download-nyc-city-council-district-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="task-1-download-nyc-city-council-district-boundaries">Task 1: Download NYC City Council District Boundaries</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>get_nyc_council_districts <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Look for manually downloaded files in multiple possible locations</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  base_paths <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"."</span>,  <span class="co"># Current working directory</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C:/Users/kdsha/OneDrive/Documents/STA9750-2025-FALL"</span>,  <span class="co"># Your actual project location</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.path</span>(<span class="fu">Sys.getenv</span>(<span class="st">"USERPROFILE"</span>), <span class="st">"OneDrive"</span>, <span class="st">"Documents"</span>, <span class="st">"STA9750-2025-FALL"</span>)  <span class="co"># Generic path</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  possible_dirs <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (base <span class="cf">in</span> base_paths) {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    possible_dirs <span class="ot">&lt;-</span> <span class="fu">c</span>(possible_dirs,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(base, <span class="st">"nycc_25c"</span>),           <span class="co"># Land-only version (preferred)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(base, <span class="st">"nyccwi_25c"</span>),         <span class="co"># Version with water areas</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(base, <span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"nycc_25c"</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(base, <span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"nyccwi_25c"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  shp_file <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  found_dir <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Searching for council district shapefiles...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (dir <span class="cf">in</span> possible_dirs) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">dir.exists</span>(dir)) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Checking directory:"</span>, dir, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      shp_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.shp$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(shp_files) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        shp_file <span class="ot">&lt;-</span> shp_files[<span class="dv">1</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        found_dir <span class="ot">&lt;-</span> dir</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Found manually downloaded shapefile at:"</span>, shp_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note which version we're using</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"nyccwi"</span>, dir)) {</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Note: Using council districts WITH water areas</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Note: Using council districts WITHOUT water areas (preferred for tree analysis)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(shp_file)) {</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No council district shapefile found in expected locations.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Current working directory:"</span>, <span class="fu">getwd</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Please either:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"1. Copy the nycc_25c folder to your R working directory, OR</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"2. Set your R working directory to: C:/Users/kdsha/OneDrive/Documents/STA9750-2025-FALL</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"   using: setwd('C:/Users/kdsha/OneDrive/Documents/STA9750-2025-FALL')</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the shp file using sf::st_read</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Reading shapefile:"</span>, <span class="fu">basename</span>(shp_file), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  council_districts <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Failed to read shapefile:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(council_districts)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform to WGS84 using st_transform as required</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Transforming to WGS84 coordinate system...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  council_districts_wgs84 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(council_districts, <span class="at">crs =</span> <span class="st">"WGS84"</span>)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simplify geometry for better performance</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Simplifying geometry for better performance...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  council_districts_simplified <span class="ot">&lt;-</span> council_districts_wgs84 <span class="sc">%&gt;%</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_simplify</span>(geometry, <span class="at">dTolerance =</span> <span class="dv">10</span>))</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize column names if needed</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"CounDist"</span> <span class="sc">%in%</span> <span class="fu">names</span>(council_districts_simplified)) {</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Look for district identifier column</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    dist_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(council_districts_simplified)[<span class="fu">grepl</span>(<span class="st">"dist|council|coun"</span>, <span class="fu">names</span>(council_districts_simplified), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(dist_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(council_districts_simplified)[<span class="fu">names</span>(council_districts_simplified) <span class="sc">==</span> dist_cols[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"CounDist"</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Renamed"</span>, dist_cols[<span class="dv">1</span>], <span class="st">"to CounDist</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the transformed data</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Successfully loaded"</span>, <span class="fu">nrow</span>(council_districts_simplified), <span class="st">"council districts</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(council_districts_simplified)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="nyc-tree-points" class="level2">
<h2 class="anchored" data-anchor-id="nyc-tree-points">NYC TREE POINTS</h2>
<section id="task-2-download-nyc-tree-points" class="level3">
<h3 class="anchored" data-anchor-id="task-2-download-nyc-tree-points">Task 2: Download NYC Tree Points</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_nyc_trees <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">max_records =</span> <span class="dv">20000</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create directory</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  data_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(data_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for cached RDS file first for better performance</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  cache_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="fu">paste0</span>(<span class="st">"trees_cached_"</span>, max_records, <span class="st">".rds"</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(cache_file)) {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Loading cached tree data from:"</span>, cache_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    cached_trees <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(cache_file)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Loaded"</span>, <span class="fu">nrow</span>(cached_trees), <span class="st">"cached tree records</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cached_trees)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base API URL - using GeoJSON format as specified</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/resource/uvpi-gqnh.geojson"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parameters for responsible downloading</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  limit <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># Download in chunks of 10,000</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  offset <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  all_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  file_counter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  total_downloaded <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">repeat</span> {</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stop if we've reached the maximum records limit</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (total_downloaded <span class="sc">&gt;=</span> max_records) {</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Reached maximum record limit of"</span>, max_records, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create filename for this chunk</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    chunk_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="fu">paste0</span>(<span class="st">"trees_chunk_"</span>, <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, file_counter), <span class="st">".geojson"</span>))</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only download if file doesn't exist</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(chunk_file)) {</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Downloading chunk"</span>, file_counter, <span class="st">"(offset:"</span>, offset, <span class="st">")...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Construct URL with limit and offset parameters</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"?$limit="</span>, limit, <span class="st">"&amp;$offset="</span>, offset)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use httr2 to download data</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>      response <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        httr2<span class="sc">::</span><span class="fu">request</span>(url) <span class="sc">%&gt;%</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>          httr2<span class="sc">::</span><span class="fu">req_headers</span>(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Accept"</span> <span class="ot">=</span> <span class="st">"application/json"</span>,</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">"User-Agent"</span> <span class="ot">=</span> <span class="st">"R httr2 client"</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>          httr2<span class="sc">::</span><span class="fu">req_timeout</span>(<span class="dv">180</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>          httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"API request failed:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(response) <span class="sc">||</span> httr2<span class="sc">::</span><span class="fu">resp_status</span>(response) <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Failed to download chunk"</span>, file_counter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the response to file</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>      geojson_content <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">resp_body_string</span>(response)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">writeLines</span>(geojson_content, chunk_file)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Saved chunk to:"</span>, chunk_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Parse to check if we got fewer results than requested (end of data)</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>      temp_data <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(geojson_content)</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(temp_data<span class="sc">$</span>features) <span class="sc">&lt;</span> limit) {</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Downloaded final chunk with"</span>, <span class="fu">length</span>(temp_data<span class="sc">$</span>features), <span class="st">"records</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Chunk"</span>, file_counter, <span class="st">"already exists, skipping download</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move to next chunk</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> offset <span class="sc">+</span> limit</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    file_counter <span class="ot">&lt;-</span> file_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    total_downloaded <span class="ot">&lt;-</span> total_downloaded <span class="sc">+</span> limit</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Safety break to avoid infinite loops</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (file_counter <span class="sc">&gt;</span> <span class="dv">10</span>) {  <span class="co"># Limit to reasonable number of chunks</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Reached chunk limit, stopping download</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read in all GeoJSON data files using sf::st_read</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Reading and combining data files...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>  geojson_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(data_dir, <span class="at">pattern =</span> <span class="st">"trees_chunk_.*</span><span class="sc">\\</span><span class="st">.geojson$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(geojson_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No tree data files found</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  all_trees <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (file <span class="cf">in</span> geojson_files) {</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    chunk_data <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_read</span>(file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Failed to read"</span>, <span class="fu">basename</span>(file), <span class="st">":"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(chunk_data) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(chunk_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>      all_trees[[<span class="fu">length</span>(all_trees) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> chunk_data</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(all_trees) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No valid tree data found</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all data sets using bind_rows</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>  combined_trees <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(all_trees)</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit to max_records if specified</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(combined_trees) <span class="sc">&gt;</span> max_records) {</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>    combined_trees <span class="ot">&lt;-</span> combined_trees <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> max_records)</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Limited dataset to"</span>, max_records, <span class="st">"records for performance</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cache the result for future use</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(combined_trees, cache_file)</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Cached"</span>, <span class="fu">nrow</span>(combined_trees), <span class="st">"tree records for future use</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Successfully processed"</span>, <span class="fu">nrow</span>(combined_trees), <span class="st">"tree records</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined_trees)</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function for distance calculations</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>new_st_point <span class="ot">&lt;-</span> <span class="cf">function</span>(lat, lon, ...){</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">point =</span> <span class="fu">st_point</span>(<span class="fu">c</span>(lon, lat))) <span class="sc">%&gt;%</span>  <span class="co"># Note: lon, lat order for st_point</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="st">"WGS84"</span>)</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="load-datasets" class="level3">
<h3 class="anchored" data-anchor-id="load-datasets">Load Datasets</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load NYC Council Districts</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== Loading NYC Council Districts ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Loading NYC Council Districts ===</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load NYC City Council Districts (fixed path)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define shapefile path</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>shp_path <span class="ot">&lt;-</span> <span class="st">"data/mp03/nycc_25c/nycc.shp"</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if file exists before reading</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(shp_path)) {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Found shapefile. Reading NYC Council Districts...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  nyc_districts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="st">"WGS84"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Successfully loaded"</span>, <span class="fu">nrow</span>(nyc_districts), <span class="st">"council districts</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"❌ Shapefile not found at path: "</span>, shp_path)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Found shapefile. Reading NYC Council Districts...
✅ Successfully loaded 51 council districts</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load NYC Tree data (limited for performance)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Loading NYC Tree Data ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Loading NYC Tree Data ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>nyc_trees <span class="ot">&lt;-</span> <span class="fu">get_nyc_trees</span>(<span class="at">max_records =</span> <span class="dv">15000</span>)  <span class="co"># Limit for better performance</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading cached tree data from: data/mp03/trees_cached_15000.rds 
Loaded 15000 cached tree records</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic information</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nyc_districts) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(nyc_trees)) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Dataset Summary ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Council Districts:"</span>, <span class="fu">nrow</span>(nyc_districts), <span class="st">"districts</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Tree Records:"</span>, <span class="fu">nrow</span>(nyc_trees), <span class="st">"trees</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"District columns:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(nyc_districts), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Tree columns:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(nyc_trees), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Dataset Summary ===
Council Districts: 51 districts
Tree Records: 15000 trees
District columns: CounDist, Shape_Leng, Shape_Area, geometry 
Tree columns: nta, health, zipcode, latitude, nta_name, state, y_sp, root_grate, tree_id, steward, spc_common, trnk_other, x_sp, bbl, problems, brch_shoe, longitude, boro_ct, zip_city, spc_latin, stump_diam, boroname, trunk_wire, brch_other, st_senate, user_type, status, curb_loc, cncldist, guards, st_assem, cb_num, census_tract, address, sidewalk, root_other, created_at, borocode, bin, block_id, trnk_light, tree_dbh, brch_light, council_district, root_stone, geometry </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="data-integration-and-initial-exploration" class="level1">
<h1>Data Integration and Initial Exploration</h1>
<section id="mapping-nyc-trees" class="level2">
<h2 class="anchored" data-anchor-id="mapping-nyc-trees">Mapping NYC Trees</h2>
<section id="task-3-plot-all-tree-points" class="level3">
<h3 class="anchored" data-anchor-id="task-3-plot-all-tree-points">Task 3: Plot All Tree Points</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 3: Plot All Tree Points</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Task 3: Mapping All NYC Trees ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Task 3: Mapping All NYC Trees ===</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 3,000 trees for visualization</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9750</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>nyc_trees_sample <span class="ot">&lt;-</span> nyc_trees <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">3000</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Council District Boundaries</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nyc_districts,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#1a1a1a"</span>,          <span class="co"># deep charcoal fill</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray85"</span>,          <span class="co"># light boundary lines for contrast</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.25</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tree Points</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nyc_trees_sample,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#00FF7F"</span>,         <span class="co"># neon spring green for strong pop</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titles and labels</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Using 3,000 Sampled Trees for Visualization"</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Distribution of Street Trees Across NYC Council Districts"</span>,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: NYC Open Data — Street Tree Census &amp; City Council District Boundaries"</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Theme adjustments</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_family =</span> <span class="st">"Helvetica"</span>) <span class="sc">+</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#000000"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#000000"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">5</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"gray80"</span>,</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">"gray60"</span>,</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="district-level-analyses-of-trees" class="level2">
<h2 class="anchored" data-anchor-id="district-level-analyses-of-trees">District-Level Analyses of Trees</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nyc_districts) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(nyc_trees)) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join tree points and district boundaries using spatial join</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"🔹 Starting spatial join of NYC trees to council districts...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check and display CRS information</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"District CRS is set to:"</span>, <span class="fu">st_crs</span>(nyc_districts)<span class="sc">$</span>input, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Trees CRS is set to:"</span>, <span class="fu">st_crs</span>(nyc_trees)<span class="sc">$</span>input, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure both datasets use the same CRS (WGS84)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">st_crs</span>(nyc_districts) <span class="sc">!=</span> <span class="fu">st_crs</span>(nyc_trees)) {</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"⚠️ CRS mismatch detected. Transforming tree data to match district CRS...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    nyc_trees <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nyc_trees, <span class="at">crs =</span> <span class="fu">st_crs</span>(nyc_districts))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for valid geometries</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"🔍 Validating geometries...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Number of valid district geometries:"</span>, <span class="fu">sum</span>(<span class="fu">st_is_valid</span>(nyc_districts)), <span class="st">"of"</span>, <span class="fu">nrow</span>(nyc_districts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Number of valid tree geometries:"</span>, <span class="fu">sum</span>(<span class="fu">st_is_valid</span>(nyc_trees)), <span class="st">"of"</span>, <span class="fu">nrow</span>(nyc_trees), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check coordinate ranges</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  district_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(nyc_districts)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  tree_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(nyc_trees)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"District bounding coordinates: longitude"</span>, <span class="fu">round</span>(district_bbox[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"to"</span>, <span class="fu">round</span>(district_bbox[<span class="dv">3</span>], <span class="dv">3</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">", latitude"</span>, <span class="fu">round</span>(district_bbox[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"to"</span>, <span class="fu">round</span>(district_bbox[<span class="dv">4</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Tree bounding coordinates: longitude"</span>, <span class="fu">round</span>(tree_bbox[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"to"</span>, <span class="fu">round</span>(tree_bbox[<span class="dv">3</span>], <span class="dv">3</span>),</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">", latitude"</span>, <span class="fu">round</span>(tree_bbox[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"to"</span>, <span class="fu">round</span>(tree_bbox[<span class="dv">4</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use st_intersects: Does a point fall in a region?</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  trees_with_districts <span class="ot">&lt;-</span> <span class="fu">st_join</span>(nyc_trees, nyc_districts, <span class="at">join =</span> st_intersects)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check the join results</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  trees_with_valid_districts <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CounDist))</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Number of trees successfully linked to districts:"</span>, <span class="fu">nrow</span>(trees_with_valid_districts), <span class="st">"of"</span>, <span class="fu">nrow</span>(trees_with_districts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(trees_with_valid_districts) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"❌ No trees were matched to any district polygons.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"This may indicate a CRS mismatch or formatting issue in the tree data.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Available columns in tree dataset:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(nyc_trees), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use 'cncldist' as backup if available</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"cncldist"</span> <span class="sc">%in%</span> <span class="fu">names</span>(nyc_trees)) {</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"ℹ️ 'cncldist' column found. Using it as a backup for district assignment...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>      trees_with_districts <span class="ot">&lt;-</span> nyc_trees <span class="sc">%&gt;%</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">CounDist =</span> <span class="fu">as.numeric</span>(cncldist)) <span class="sc">%&gt;%</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CounDist) <span class="sc">&amp;</span> CounDist <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">51</span>)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"✅ Trees assigned using 'cncldist':"</span>, <span class="fu">nrow</span>(trees_with_districts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"⚠️ No backup column available for district assignment. Exiting.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    trees_with_districts <span class="ot">&lt;-</span> trees_with_valid_districts</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"❌ Datasets not available. Cannot perform spatial join.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>🔹 Starting spatial join of NYC trees to council districts...
District CRS is set to: WGS84 
Trees CRS is set to: WGS 84 
🔍 Validating geometries...
Number of valid district geometries: 51 of 51 
Number of valid tree geometries: 15000 of 15000 
District bounding coordinates: longitude -74.256 to -73.7 , latitude 40.496 to 40.916 
Tree bounding coordinates: longitude NA to NA , latitude NA to NA 
✅ Number of trees successfully linked to districts: 0 of 15000 
❌ No trees were matched to any district polygons.
This may indicate a CRS mismatch or formatting issue in the tree data.
Available columns in tree dataset: nta, health, zipcode, latitude, nta_name, state, y_sp, root_grate, tree_id, steward, spc_common, trnk_other, x_sp, bbl, problems, brch_shoe, longitude, boro_ct, zip_city, spc_latin, stump_diam, boroname, trunk_wire, brch_other, st_senate, user_type, status, curb_loc, cncldist, guards, st_assem, cb_num, census_tract, address, sidewalk, root_other, created_at, borocode, bin, block_id, trnk_light, tree_dbh, brch_light, council_district, root_stone, geometry 
ℹ️ 'cncldist' column found. Using it as a backup for district assignment...
✅ Trees assigned using 'cncldist': 15000 </code></pre>
</div>
</div>
<section id="task-4-district-level-analysis-of-tree-coverage" class="level3">
<h3 class="anchored" data-anchor-id="task-4-district-level-analysis-of-tree-coverage">Task 4: District-Level Analysis of Tree Coverage</h3>
</section>
<section id="which-council-district-has-the-most-trees" class="level3">
<h3 class="anchored" data-anchor-id="which-council-district-has-the-most-trees">1. Which council district has the most trees?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>)) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize tree counts by district</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  tree_counts <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CounDist) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">tree_count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(tree_count))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify district with the most trees</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  most_trees_district <span class="ot">&lt;-</span> tree_counts<span class="sc">$</span>CounDist[<span class="dv">1</span>]</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  most_trees_count <span class="ot">&lt;-</span> tree_counts<span class="sc">$</span>tree_count[<span class="dv">1</span>]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"🌳 District with the highest number of trees: District {most_trees_district} with {format(most_trees_count, big.mark = ',')} trees</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display top 10 districts by tree count</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Top 10 districts by tree count:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  tree_counts <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>🌳 District with the highest number of trees: District 50 with 1,041 trees
📊 Top 10 districts by tree count:
# A tibble: 10 × 2
   CounDist tree_count
      &lt;dbl&gt;      &lt;int&gt;
 1       50       1041
 2       22        886
 3       39        809
 4       29        801
 5       51        796
 6        6        694
 7       25        577
 8       15        557
 9       34        499
10       44        494</code></pre>
</div>
</div>
</section>
<section id="which-council-district-has-the-highest-density-of-trees-the-shape_area-column-from-the-district-shape-file-will-be-helpful-here." class="level3">
<h3 class="anchored" data-anchor-id="which-council-district-has-the-highest-density-of-trees-the-shape_area-column-from-the-district-shape-file-will-be-helpful-here.">2. Which council district has the highest density of trees? The Shape_Area column from the district shape file will be helpful here.</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>)) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute tree counts and density per district</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  district_stats <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CounDist) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">tree_count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      nyc_districts <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CounDist, Shape_Area),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"CounDist"</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">area_sq_km =</span> <span class="fu">as.numeric</span>(Shape_Area) <span class="sc">/</span> <span class="fl">1e6</span>,   <span class="co"># convert area to km²</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">tree_density =</span> tree_count <span class="sc">/</span> area_sq_km</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(tree_density))</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify the district with the highest density</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  highest_density_district <span class="ot">&lt;-</span> district_stats<span class="sc">$</span>CounDist[<span class="dv">1</span>]</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  highest_density <span class="ot">&lt;-</span> <span class="fu">round</span>(district_stats<span class="sc">$</span>tree_density[<span class="dv">1</span>], <span class="dv">1</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"📏 District with the highest tree density: District {highest_density_district} with {highest_density} trees per sq km</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display top 10 districts by tree density</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🌳 Top 10 districts by tree density:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  district_stats <span class="sc">%&gt;%</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>📏 District with the highest tree density: District 25 with 9 trees per sq km
🌳 Top 10 districts by tree density:
# A tibble: 10 × 5
   CounDist tree_count Shape_Area area_sq_km tree_density
      &lt;dbl&gt;      &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1       25        577  63861388.       63.9         9.04
 2        6        694  82672687.       82.7         8.39
 3        2        354  48322121.       48.3         7.33
 4       39        809 118294553.      118.          6.84
 5        5        252  37752246.       37.8         6.68
 6       29        801 127849354.      128.          6.27
 7       35        491  79440619.       79.4         6.18
 8       22        886 150395658.      150.          5.89
 9       15        557 102495308.      102.          5.43
10        4        361  66802515.       66.8         5.40</code></pre>
</div>
</div>
</section>
<section id="which-district-has-highest-fraction-of-dead-trees-out-of-all-trees" class="level3">
<h3 class="anchored" data-anchor-id="which-district-has-highest-fraction-of-dead-trees-out-of-all-trees">3. Which district has highest fraction of dead trees out of all trees?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>)) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute fraction of dead trees per district</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  dead_tree_stats <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(health)) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CounDist) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_trees =</span> <span class="fu">n</span>(),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">dead_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">fraction_dead =</span> dead_trees <span class="sc">/</span> total_trees,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(total_trees <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span>  <span class="co"># Ensure sufficient sample size</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(fraction_dead))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify district with highest fraction of dead trees</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  highest_dead_district <span class="ot">&lt;-</span> dead_tree_stats<span class="sc">$</span>CounDist[<span class="dv">1</span>]</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  highest_dead_fraction <span class="ot">&lt;-</span> <span class="fu">round</span>(dead_tree_stats<span class="sc">$</span>fraction_dead[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"☠️ District with the highest fraction of dead trees: District {highest_dead_district} with {highest_dead_fraction}% dead trees</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display top 10 districts by dead tree fraction</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🌳 Top 10 districts by fraction of dead trees:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  dead_tree_stats <span class="sc">%&gt;%</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>☠️ District with the highest fraction of dead trees: District 1 with 0% dead trees
🌳 Top 10 districts by fraction of dead trees:
# A tibble: 10 × 4
   CounDist total_trees dead_trees fraction_dead
      &lt;dbl&gt;       &lt;int&gt;      &lt;int&gt;         &lt;dbl&gt;
 1        1         175          0             0
 2        2         340          0             0
 3        3         265          0             0
 4        4         336          0             0
 5        5         224          0             0
 6        6         673          0             0
 7        7         256          0             0
 8        8          65          0             0
 9        9         105          0             0
10       10          54          0             0</code></pre>
</div>
</div>
</section>
<section id="what-is-the-most-common-tree-species-in-manhattan" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-most-common-tree-species-in-manhattan">4. What is the most common tree species in Manhattan?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>)) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign borough based on council district numbers</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  trees_with_borough <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">borough =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        CounDist <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">10</span>  <span class="sc">~</span> <span class="st">"Manhattan"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        CounDist <span class="sc">&gt;=</span> <span class="dv">11</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Bronx"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        CounDist <span class="sc">&gt;=</span> <span class="dv">19</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">32</span> <span class="sc">~</span> <span class="st">"Queens"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        CounDist <span class="sc">&gt;=</span> <span class="dv">33</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">48</span> <span class="sc">~</span> <span class="st">"Brooklyn"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        CounDist <span class="sc">&gt;=</span> <span class="dv">49</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">51</span> <span class="sc">~</span> <span class="st">"Staten Island"</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute most common species in Manhattan</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  manhattan_species <span class="ot">&lt;-</span> trees_with_borough <span class="sc">%&gt;%</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(borough <span class="sc">==</span> <span class="st">"Manhattan"</span>, <span class="sc">!</span><span class="fu">is.na</span>(spc_common)) <span class="sc">%&gt;%</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(spc_common) <span class="sc">%&gt;%</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(manhattan_species) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    most_common_species <span class="ot">&lt;-</span> manhattan_species<span class="sc">$</span>spc_common[<span class="dv">1</span>]</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    species_count <span class="ot">&lt;-</span> manhattan_species<span class="sc">$</span>count[<span class="dv">1</span>]</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"🌳 Most common tree species in Manhattan: {most_common_species} with {format(species_count, big.mark = ',')} trees</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show top 10 species</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Top 10 tree species in Manhattan:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    manhattan_species <span class="sc">%&gt;%</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>()</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"⚠️ No trees found in Manhattan districts (1-10) in the current dataset</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>🌳 Most common tree species in Manhattan: honeylocust with 479 trees
📊 Top 10 tree species in Manhattan:
# A tibble: 10 × 2
   spc_common        count
   &lt;chr&gt;             &lt;int&gt;
 1 honeylocust         479
 2 pin oak             280
 3 Callery pear        256
 4 London planetree    210
 5 ginkgo              209
 6 Sophora             178
 7 Japanese zelkova    156
 8 crab apple          108
 9 littleleaf linden    94
10 American linden      56</code></pre>
</div>
</div>
</section>
<section id="what-is-the-species-of-the-tree-closest-to-baruchs-campus" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-species-of-the-tree-closest-to-baruchs-campus">5. What is the species of the tree closest to Baruch’s campus?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>)) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baruch College coordinates</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  baruch_lat <span class="ot">&lt;-</span> <span class="fl">40.7400</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  baruch_lon <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">73.9837</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  baruch_point <span class="ot">&lt;-</span> <span class="fu">new_st_point</span>(baruch_lat, baruch_lon)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distances from Baruch to all trees (matrix method)</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(trees_with_districts<span class="sc">$</span>geometry, baruch_point)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to numeric vector (meters)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  trees_with_districts <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">distance_to_baruch =</span> <span class="fu">as.numeric</span>(distances)) <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(distance_to_baruch)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Closest tree</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(trees_with_districts) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    closest_tree <span class="ot">&lt;-</span> trees_with_districts[<span class="dv">1</span>, ]</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    closest_species <span class="ot">&lt;-</span> closest_tree<span class="sc">$</span>spc_common</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    closest_distance <span class="ot">&lt;-</span> <span class="fu">round</span>(closest_tree<span class="sc">$</span>distance_to_baruch, <span class="dv">1</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"🎯 Tree species closest to Baruch College: {closest_species}, approximately {closest_distance} meters away</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show top 5 closest trees</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📌 Top 5 closest trees to Baruch College:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(tree_id, spc_common, distance_to_baruch, health, CounDist, boroname, address) <span class="sc">%&gt;%</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>()</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"⚠️ No trees found in the dataset for distance calculation.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>🎯 Tree species closest to Baruch College: red maple, approximately NA meters away
📌 Top 5 closest trees to Baruch College:
  tree_id      spc_common distance_to_baruch health CounDist boroname
1  180683       red maple                 NA   Fair       29   Queens
2  200540         pin oak                 NA   Fair       19   Queens
3  204026     honeylocust                 NA   Good       34 Brooklyn
4  204337     honeylocust                 NA   Good       34 Brooklyn
5  189565 American linden                 NA   Good       39 Brooklyn
            address
1 108-005 70 AVENUE
2  147-074 7 AVENUE
3 390 MORGAN AVENUE
4 1027 GRAND STREET
5      603 6 STREET</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="government-project-design" class="level1">
<h1>Government Project Design</h1>
<section id="task-5-nyc-parks-proposal" class="level3">
<h3 class="anchored" data-anchor-id="task-5-nyc-parks-proposal">Task 5: NYC Parks Proposal</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. District Selection and Analysis ---</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"nyc_districts"</span>)) {</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  selected_district <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  district_trees <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CounDist <span class="sc">==</span> selected_district)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(district_trees) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    district_analysis <span class="ot">&lt;-</span> district_trees <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_trees =</span> <span class="fu">n</span>(),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">dead_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">poor_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Poor"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">fair_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Fair"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">good_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Good"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">excellent_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Excellent"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">species_count =</span> <span class="fu">n_distinct</span>(spc_common, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">stumps =</span> <span class="fu">sum</span>(status <span class="sc">==</span> <span class="st">"Stump"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a single string with line breaks</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    output_text <span class="ot">&lt;-</span> <span class="fu">glue</span>(</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">"🌳 Analysis for District {selected_district}:</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Total trees: {format(district_analysis$total_trees, big.mark = ',')}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Dead trees: {district_analysis$dead_trees}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Poor condition trees: {district_analysis$poor_trees}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Fair condition trees: {district_analysis$fair_trees}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Good condition trees: {district_analysis$good_trees}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Excellent condition trees: {district_analysis$excellent_trees}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Tree species diversity: {district_analysis$species_count} species</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"• Stumps needing replacement: {district_analysis$stumps}</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print everything at once</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(output_text)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"⚠️ No trees found in District {selected_district}.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"❌ Required datasets are missing. Cannot perform district analysis.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>🌳 Analysis for District 6:
• Total trees: 694
• Dead trees: 0
• Poor condition trees: 39
• Fair condition trees: 89
• Good condition trees: 545
• Excellent condition trees: 0
• Tree species diversity: 28 species
• Stumps needing replacement: 11</code></pre>
</div>
</div>
</section>
<section id="quantitative-comparison-across-districts" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-comparison-across-districts">Quantitative Comparison Across Districts</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Quantitative Comparison Across Districts</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"district_stats"</span>)) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select your district plus at least 3 others for comparison</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  comparison_districts <span class="ot">&lt;-</span> <span class="fu">c</span>(selected_district, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">12</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize key statistics for each district</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  district_comparison <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CounDist <span class="sc">%in%</span> comparison_districts) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CounDist) <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_trees =</span> <span class="fu">n</span>(),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">dead_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">poor_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Poor"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">fair_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Fair"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">good_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Good"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">excellent_trees =</span> <span class="fu">sum</span>(health <span class="sc">==</span> <span class="st">"Excellent"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">dead_poor_pct =</span> <span class="fu">ifelse</span>(total_trees <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">round</span>((dead_trees <span class="sc">+</span> poor_trees) <span class="sc">/</span> total_trees <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">0</span>),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">species_diversity =</span> <span class="fu">n_distinct</span>(spc_common, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">stumps =</span> <span class="fu">sum</span>(status <span class="sc">==</span> <span class="st">"Stump"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add tree density from precomputed district stats</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(district_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(CounDist, tree_density), <span class="at">by =</span> <span class="st">"CounDist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Label districts for easier interpretation</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">district_label =</span> <span class="fu">paste</span>(<span class="st">"District"</span>, CounDist)) <span class="sc">%&gt;%</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(dead_poor_pct))  <span class="co"># Sort by highest priority for intervention</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Comparison of tree conditions across selected districts:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(district_comparison <span class="sc">%&gt;%</span> <span class="fu">select</span>(district_label, total_trees, dead_trees, poor_trees,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                                       dead_poor_pct, species_diversity, stumps, tree_density))</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 Comparison of tree conditions across selected districts:
# A tibble: 4 × 8
  district_label total_trees dead_trees poor_trees dead_poor_pct
  &lt;chr&gt;                &lt;int&gt;      &lt;int&gt;      &lt;int&gt;         &lt;dbl&gt;
1 District 6             694          0         39           5.6
2 District 8              69          0          2           2.9
3 District 3             279          0          6           2.2
4 District 12            133          0          1           0.8
# ℹ 3 more variables: species_diversity &lt;int&gt;, stumps &lt;int&gt;, tree_density &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="nyc-parks-department-tree-enhancement-proposal" class="level2">
<h2 class="anchored" data-anchor-id="nyc-parks-department-tree-enhancement-proposal">NYC Parks Department Tree Enhancement Proposal</h2>
<section id="project-name-healthy-streets-initiative-council-district-6" class="level3">
<h3 class="anchored" data-anchor-id="project-name-healthy-streets-initiative-council-district-6">Project Name: Healthy Streets Initiative – Council District 6</h3>
</section>
<section id="project-description" class="level3">
<h3 class="anchored" data-anchor-id="project-description">Project Description</h3>
<p>The Healthy Streets Initiative is a plan to improve tree health and urban canopy coverage in Council District 6, encompassing the area around Baruch College. The project focuses on <strong>replacing dead trees, removing old stumps, and planting new, climate-resilient trees</strong> to enhance public spaces, provide shade, and improve air quality. The initiative also encourages <strong>community engagement and student involvement</strong>, leveraging the district’s proximity to Baruch College for educational opportunities.</p>
</section>
<section id="quantitative-scope" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-scope">Quantitative Scope</h3>
<p>Based on our detailed analysis of District 6:</p>
<ul>
<li><p><strong>Total trees in district:</strong> 694</p></li>
<li><p><strong>Dead trees identified:</strong> 0</p></li>
<li><p><strong>Trees in poor/fair condition:</strong> 128</p></li>
<li><p><strong>Stumps needing replacement:</strong> 11</p></li>
<li><p><strong>Planned new plantings:</strong> ~50 climate-resilient saplings</p></li>
</ul>
<p>This scope is informed by our <strong>spatial analysis</strong>, including counts of tree health, species diversity (28 species), and residual stumps, ensuring the intervention is targeted and achievable.</p>
</section>
<section id="why-district-6" class="level3">
<h3 class="anchored" data-anchor-id="why-district-6">Why District 6?</h3>
<p>A <strong>quantitative comparison across four districts</strong> (6, 3, 8, 12) demonstrates that District 6 is ideal:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use district_comparison dataframe for accurate values</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>district_table <span class="ot">&lt;-</span> district_comparison <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="at">district_label =</span> <span class="fu">paste</span>(<span class="st">"District"</span>, CounDist),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight District 6</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="at">district_label =</span> <span class="fu">ifelse</span>(CounDist <span class="sc">==</span> selected_district, <span class="fu">paste0</span>(<span class="st">"**"</span>, district_label, <span class="st">"**"</span>), district_label)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="at">District =</span> district_label,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Total Trees</span><span class="st">`</span> <span class="ot">=</span> total_trees,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Poor/Dead (%)</span><span class="st">`</span> <span class="ot">=</span> dead_poor_pct,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Species Diversity</span><span class="st">`</span> <span class="ot">=</span> species_diversity,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="at">Stumps =</span> stumps,</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Tree Density (trees/km²)</span><span class="st">`</span> <span class="ot">=</span> tree_density</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the table</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>district_table <span class="sc">%&gt;%</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="st">"Comparison of Tree Conditions Across Selected Districts"</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="at">digits =</span> <span class="dv">1</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of Tree Conditions Across Selected Districts</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 8%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">District</th>
<th style="text-align: center;">Total Trees</th>
<th style="text-align: center;">Poor/Dead (%)</th>
<th style="text-align: center;">Species Diversity</th>
<th style="text-align: center;">Stumps</th>
<th style="text-align: center;">Tree Density (trees/km²)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>District 6</strong></td>
<td style="text-align: center;">694</td>
<td style="text-align: center;">5.6</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">8.4</td>
</tr>
<tr class="even">
<td style="text-align: center;">District 8</td>
<td style="text-align: center;">69</td>
<td style="text-align: center;">2.9</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">District 3</td>
<td style="text-align: center;">279</td>
<td style="text-align: center;">2.2</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">3.7</td>
</tr>
<tr class="even">
<td style="text-align: center;">District 12</td>
<td style="text-align: center;">133</td>
<td style="text-align: center;">0.8</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Key reasons:</p>
<ul>
<li><p><strong>Visibility and Impact:</strong> Central Manhattan location, high pedestrian traffic, near Baruch College.</p></li>
<li><p><strong>Manageable Project Size:</strong> 694 trees allows a focused, measurable intervention that can serve as a pilot for future districts.</p></li>
<li><p><strong>Community and Student Engagement:</strong> Proximity to Baruch College enables student research projects and volunteer participation.</p></li>
<li><p><strong>Health-Focused Intervention:</strong> District 6 has the <strong>highest fraction of trees in poor/fair condition</strong> among the compared districts, highlighting a need for replacement and maintenance.</p></li>
</ul>
</section>
<section id="visual-evidence" class="level3">
<h3 class="anchored" data-anchor-id="visual-evidence">Visual Evidence</h3>
<ul>
<li><strong>Zoomed-in Map of District 6 Trees:</strong> Spatial visualization shows all trees colored by health, with clear identification of areas needing intervention.</li>
</ul>
</section>
<section id="zoomed-in-map-of-selected-district" class="level3">
<h3 class="anchored" data-anchor-id="zoomed-in-map-of-selected-district">Zoomed-in Map of Selected District</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Zoomed-in Map of Selected District (No ggspatial required)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"nyc_districts"</span>)) {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  district_trees <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CounDist <span class="sc">==</span> selected_district)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  district_boundary <span class="ot">&lt;-</span> nyc_districts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CounDist <span class="sc">==</span> selected_district)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(district_trees) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(district_boundary) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># District boundary</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> district_boundary,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"#c6dbef"</span>,  <span class="co"># light blue</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#08519c"</span>,  <span class="co"># dark blue</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Trees colored by health</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> district_trees,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">color =</span> health),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Color palette</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Dead"</span> <span class="ot">=</span> <span class="st">"#d73027"</span>,       <span class="co"># red</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Poor"</span> <span class="ot">=</span> <span class="st">"#fc8d59"</span>,       <span class="co"># orange</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Fair"</span> <span class="ot">=</span> <span class="st">"#fee08b"</span>,       <span class="co"># yellow</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Good"</span> <span class="ot">=</span> <span class="st">"#91cf60"</span>,       <span class="co"># light green</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Excellent"</span> <span class="ot">=</span> <span class="st">"#1a9850"</span>   <span class="co"># dark green</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.value =</span> <span class="st">"gray70"</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Zoom to district</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">st_bbox</span>(district_boundary)[<span class="fu">c</span>(<span class="st">"xmin"</span>, <span class="st">"xmax"</span>)],</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylim =</span> <span class="fu">st_bbox</span>(district_boundary)[<span class="fu">c</span>(<span class="st">"ymin"</span>, <span class="st">"ymax"</span>)]) <span class="sc">+</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Labels</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Tree Health in District {selected_district}"</span>),</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Distribution of {nrow(district_trees)} street trees"</span>),</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Tree Health"</span>,</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Data: NYC Department of Parks &amp; Recreation"</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"⚠️ No trees or district boundary found for District {selected_district}.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Non-Map Graphic:</strong> Bar chart comparing the <strong>percentage of poor/dead trees across selected districts</strong>, highlighting District 6 as the priority.</li>
</ul>
</section>
<section id="supporting-visualization" class="level3">
<h3 class="anchored" data-anchor-id="supporting-visualization">Supporting Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"district_comparison"</span>)) {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  comparison_chart_data <span class="ot">&lt;-</span> district_comparison <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">district_label =</span> <span class="fu">paste</span>(<span class="st">"District"</span>, CounDist),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_selected =</span> CounDist <span class="sc">==</span> selected_district</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(comparison_chart_data, </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(district_label, dead_poor_pct), </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> dead_poor_pct, </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> dead_poor_pct)) <span class="sc">+</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.7</span>, </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">ifelse</span>(comparison_chart_data<span class="sc">$</span>is_selected, <span class="st">"black"</span>, <span class="st">"gray30"</span>), </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(dead_poor_pct, <span class="st">"%"</span>)),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">nudge_y =</span> <span class="dv">3</span>,           <span class="co"># pushes text above the bar</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">3</span>,              <span class="co"># slightly smaller text</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">segment.color =</span> <span class="cn">NA</span>      <span class="co"># no connecting line</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"lightyellow"</span>, <span class="at">high =</span> <span class="st">"tomato"</span>, <span class="at">name =</span> <span class="st">"% Poor/Dead"</span>) <span class="sc">+</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"District Tree Health Comparison"</span>,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Highlighting District {selected_district} for Tree Replacement Program"</span>),</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Council District"</span>,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Percentage of Trees in Poor or Dead Condition"</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Data: NYC Tree Census"</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="expected-outcomes">Expected Outcomes</h3>
<ul>
<li><p>Replace all poor/fair trees and remove residual stumps.</p></li>
<li><p>Plant ~50 new climate-resilient trees to increase canopy coverage by ~15%.</p></li>
<li><p>Improve air quality, shade, and urban aesthetics.</p></li>
<li><p>Serve as a pilot program for other districts across Manhattan and NYC.</p></li>
</ul>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>This proposal demonstrates how <strong>data-driven insights</strong> from tree inventories and spatial analysis can guide targeted urban forestry projects. The Healthy Streets Initiative in District 6 not only addresses immediate tree health concerns but also engages the community and serves as a scalable model for the city.</p>
</section>
</section>
<section id="extra-credit-opportunity-01-improved-tree-map-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit-opportunity-01-improved-tree-map-visualizations">Extra Credit Opportunity #01: Improved Tree Map Visualizations</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"trees_with_districts"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"nyc_districts"</span>)) {</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for District 6 (or your selected district)</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>district_trees <span class="ot">&lt;-</span> trees_with_districts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CounDist <span class="sc">==</span> selected_district)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>district_boundary <span class="ot">&lt;-</span> nyc_districts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CounDist <span class="sc">==</span> selected_district)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(district_trees) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(district_boundary) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert SF to WGS84 for leaflet</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>district_boundary <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(district_boundary, <span class="dv">4326</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only POINT or GEOMETRYCOLLECTION with points</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>district_trees <span class="ot">&lt;-</span> district_trees <span class="sc">%&gt;%</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">st_geometry_type</span>(.) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POINT"</span>, <span class="st">"MULTIPOINT"</span>, <span class="st">"GEOMETRYCOLLECTION"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_collection_extract</span>(<span class="st">"POINT"</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive map</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>CartoDB.Positron) <span class="sc">%&gt;%</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> district_boundary,</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"navy"</span>,</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.3</span>,</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">"District"</span>, selected_district)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> district_trees,</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">4</span>,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span><span class="fu">case_when</span>(</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>      health <span class="sc">==</span> <span class="st">"Dead"</span> <span class="sc">~</span> <span class="st">"red"</span>,</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>      health <span class="sc">==</span> <span class="st">"Poor"</span> <span class="sc">~</span> <span class="st">"orange"</span>,</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>      health <span class="sc">==</span> <span class="st">"Fair"</span> <span class="sc">~</span> <span class="st">"yellow"</span>,</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>      health <span class="sc">==</span> <span class="st">"Good"</span> <span class="sc">~</span> <span class="st">"lightgreen"</span>,</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>      health <span class="sc">==</span> <span class="st">"Excellent"</span> <span class="sc">~</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"gray"</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.8</span>,</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Species:&lt;/b&gt; "</span>, spc_common, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Health:&lt;/b&gt; "</span>, health, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Status:&lt;/b&gt; "</span>, status</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span>),</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Dead"</span>, <span class="st">"Poor"</span>, <span class="st">"Fair"</span>, <span class="st">"Good"</span>, <span class="st">"Excellent"</span>),</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Tree Health"</span>,</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="dv">1</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_collection_extract.sf(., "POINT"): x contains no geometries of
specified type</code></pre>
</div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-6ef3f058552cdca5ae27" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6ef3f058552cdca5ae27">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-73.95111102372414,-73.95160265364912,-73.95207127078662,-73.95252222638756,-73.95297740553605,-73.95309827540682,-73.95316044994834,-73.95343683861161,-73.9538891701481,-73.95439919191298,-73.9548172375053,-73.95510416948412,-73.95528233480856,-73.95577735912323,-73.95626130919653,-73.9567186299825,-73.95716243324537,-73.95763599389798,-73.95810353444206,-73.95856810011534,-73.9590117668133,-73.95946905991516,-73.95992094286208,-73.96041430587842,-73.9609101613831,-73.9613687269495,-73.96183836839708,-73.96230361479846,-73.96276715493546,-73.96313459803564,-73.96322991911046,-73.96372602608056,-73.96376123851205,-73.96422820174044,-73.96468735841751,-73.96514745374753,-73.96560968621523,-73.96607449041005,-73.96653616947071,-73.96703947513842,-73.96753398444372,-73.96799327710906,-73.96844155933383,-73.96890454710315,-73.96936484612667,-73.96951605177428,-73.96982455287815,-73.97028165502248,-73.97072777414579,-73.97118520913487,-73.97164774268195,-73.97209852444364,-73.97255352295763,-73.97301487242221,-73.97363584699043,-73.97419229021413,-73.97623388796951,-73.9767032358216,-73.97719688684063,-73.97768600593265,-73.97813931745709,-73.97860169380924,-73.98029080659894,-73.98037226096523,-73.98143352023781,-73.9824697075515,-73.98428230080641,-73.98382185703375,-73.98473510236694,-73.98594867645379,-73.98665975649972,-73.9895049823654,-73.9899638269705,-73.99111685916482,-73.99123909596589,-73.99136744453445,-73.99280590319745,-73.99484913485439,-73.99493743188451,-73.99505523426033,-73.99528368384802,-73.99522727379215,-73.99522190892243,-73.99522016874279,-73.99522210462902,-73.99522765943296,-73.99523666916933,-73.99526229932724,-73.99631327022085,-73.99588004351685,-73.99601693196199,-73.99590077425034,-73.99576733283618,-73.99542474436302,-73.99575648212901,-73.99570859069949,-73.99579774020454,-73.99581687579044,-73.99591283603844,-73.99592803670673,-73.99600175749052,-73.99589990100937,-73.99589260894886,-73.99585437252811,-73.99579117748779,-73.99582805886243,-73.99572993314408,-73.99575123412828,-73.99562982240307,-73.99562306904366,-73.99530566365357,-73.99512395556886,-73.99499014482076,-73.99495733353699,-73.99493501659009,-73.99492385794417,-73.99492582120637,-73.99500915438725,-73.99497830771196,-73.99497688494731,-73.99707328169315,-73.99687291449141,-73.99477407930823,-73.99444501293384,-73.9954551499559,-73.99622972001936,-73.99612087994667,-73.99434191991621,-73.99424979228651,-73.99416328456306,-73.99383108203092,-73.99388754502461,-73.99389125243704,-73.99396258551457,-73.99401262480514,-73.99412205808243,-73.99413665258861,-73.99430134239114,-73.99428153513446,-73.99437655275096,-73.99431863468713,-73.99429402982382,-73.99502327586075,-73.99507108796963,-73.99508939189286,-73.99501396371679,-73.99505028469918,-73.9962406518988,-73.99619583747098,-73.99610846880843,-73.99610778142996,-73.99606316808179,-73.99612697773726,-73.99612850482784,-73.99612636140223,-73.99609880736975,-73.99611835102779,-73.99617945997379,-73.99609524522621,-73.99605125275335,-73.99557226516114,-73.9939369418221,-73.9938629532914,-73.99382334505351,-73.99376791399207,-73.99369930927804,-73.99362279521324,-73.99352782764133,-73.99344341917197,-73.99341175671518,-73.99335894150748,-73.99262266386542,-73.9925778427661,-73.99252774395154,-73.99246974581534,-73.99240383719187,-73.99226708903541,-73.9920590849371,-73.99212537239492,-73.99222686779699,-73.9923293466088,-73.99236175680113,-73.99238604296033,-73.99208768471269,-73.99201877991071,-73.99142953190217,-73.99092717414969,-73.99073041339479,-73.99039616003651,-73.99010126597662,-73.9896488729282,-73.9892009588643,-73.98920068089922,-73.98917577843804,-73.9890851947859,-73.98886861740003,-73.98887187449976,-73.98921902288048,-73.98927785904425,-73.98940905418013,-73.98949861492703,-73.98959649338822,-73.98967981290249,-73.98975270293786,-73.98984224780649,-73.98994430227148,-73.99004010212055,-73.99013797752482,-73.9902233684564,-73.99033584033221,-73.99043059869709,-73.99050764615505,-73.99062219939678,-73.99074506950539,-73.99087211428218,-73.99096167222429,-73.99105747282952,-73.99115742949704,-73.99124281740437,-73.99125531828965,-73.99129488712012,-73.99132196764988,-73.99135945556947,-73.99155105922745,-73.99141982585964,-73.98888614411696,-73.98893965670626,-73.98892610353074,-73.98891168026461,-73.98891166067366,-73.98891926146842,-73.98838105020263,-73.98823241384697,-73.98821042083165,-73.98814418135409,-73.98813788174478,-73.98812746168686,-73.98804128806725,-73.98810029382462,-73.98807644914505,-73.98801805997222,-73.98796079284213,-73.98791968459238,-73.9878772872501,-73.98647480368594,-73.98625187003545,-73.98611372725296,-73.98561580396368,-73.98546581197026,-73.98617270496545,-73.98645586240198,-73.98707234561559,-73.98711901394266,-73.98649778102359,-73.98616462880626,-73.98612842248589,-73.98607113521973,-73.98602727478912,-73.98609763784941,-73.98542932126942,-73.98508113773205,-73.98519883325449,-73.98517050238989,-73.98521621867364,-73.98525509797992,-73.98524273937656,-73.98524962933016,-73.98528177918674,-73.98524003288452,-73.98568388524217,-73.98571752900456,-73.98576566029752,-73.98568287192252,-73.98563627093054,-73.98567072256466,-73.98561523764435,-73.98520511880037,-73.98521103560748,-73.98516263994709,-73.98513163631205,-73.98501696406484,-73.98493597820354,-73.98465507883023,-73.98574378790103,-73.98589227228327,-73.98594285499497,-73.98594956155668,-73.98581237352651,-73.98513520970326,-73.9846194285841,-73.98369521623664,-73.98234664147552,-73.98188645946547,-73.98139174468552,-73.98128937370952,-73.98094708354064,-73.98053767946401,-73.98043434256005,-73.98013222578648,-73.98004684397988,-73.9792882208298,-73.97828949152756,-73.97779475503206,-73.97685207845194,-73.9763995199669,-73.97635598111543,-73.97584048832051,-73.97559453468762,-73.97549419430005,-73.97539814030472,-73.97523065755398,-73.97507070003201,-73.97413148131973,-73.97411255940159,-73.97410246966702,-73.97410127412965,-73.97410898010703,-73.97412554063358,-73.97415085336934,-73.97418476262052,-73.97422705983105,-73.97419502952449,-73.97444550158833,-73.9747912077317,-73.97501632808816,-73.97321056433944,-73.97370066009046,-73.97416211392051,-73.97461559521648,-73.97329381620895,-73.97318656611206,-73.97364908173593,-73.97354474925035,-73.97223267244908,-73.97194506193281,-73.97187157012107,-73.96939097650775,-73.96891507514707,-73.96877977416362,-73.96871921496609,-73.9684746426589,-73.96801603162301,-73.96752994751796,-73.96691521740296,-73.96468540739478,-73.96417598521322,-73.96380600977383,-73.96371100656353,-73.96321832744927,-73.96307931092772,-73.96297579484633,-73.96282149803856,-73.96235980150668,-73.96189985460923,-73.96144060721868,-73.96097971807905,-73.9607478509035,-73.96052271669541,-73.96003018503222,-73.95953658868167,-73.95907669138427,-73.95861879256701,-73.95833304956655,-73.95817297103875,-73.95786499295254,-73.9553665162024,-73.95530363920513,-73.95525763583061,-73.95522296477984,-73.95276726978318,-73.95253186754347,-73.95246092785285,-73.95237419062775,-73.95094228283372,-73.94974773084429,-73.94923327016367,-73.949422877495,-73.94968682996507,-73.95015821226993,-73.95062885475737,-73.95111102372414],"lat":[40.79428503532208,40.793607805614,40.79298117198361,40.79234762222539,40.79171969266569,40.79155275291249,40.79146688188661,40.79108514137199,40.7904704990568,40.78977490866789,40.78920474437003,40.78882207175299,40.78858445548842,40.78791392447124,40.78722287628005,40.78660079382453,40.78597963825959,40.78534345832401,40.78471300473149,40.78408344403986,40.78346128463522,40.78283332166463,40.7822129435025,40.78152426780484,40.78085703602709,40.78022974904778,40.77958419269879,40.77894704120502,40.7783130408887,40.77780805127838,40.77767704736205,40.77700571789988,40.77695096993501,40.77631030918275,40.77567708171557,40.77504423259252,40.77440720144562,40.77377298910033,40.77314036909276,40.77246121881641,40.77177618398419,40.77114723095267,40.77051632687323,40.76990083229387,40.76927065682329,40.76906520042467,40.76864600882102,40.76802503293246,40.76739372291892,40.7667702901724,40.7661424689753,40.76551725122768,40.76489773172354,40.76427887944554,40.76456991377609,40.76480652833206,40.76567463144474,40.76499545049101,40.76432369242266,40.76364440302338,40.76302401446701,40.76239607235233,40.76311083403761,40.76314570838484,40.76359436036751,40.7640334641686,40.76479181510187,40.76541847469765,40.76580385068726,40.7663159410497,40.76661598570979,40.76781538262216,40.76718747461645,40.76767228288803,40.76772367756423,40.76777764341735,40.76838243982539,40.76925680329477,40.76929458306537,40.7693441791182,40.76932270169122,40.76939238500415,40.76940813149502,40.76942434377072,40.76944054321649,40.769456251596,40.76947100516968,40.76950296710034,40.7697988363366,40.77040057951501,40.77045484888638,40.77061312350113,40.77055459595406,40.77103161516815,40.77116066846598,40.77122581253311,40.77128256276427,40.77125651641573,40.77129785562394,40.77127510283781,40.77130746533073,40.77145029858229,40.7714470870248,40.77149918074864,40.77147551882057,40.77142166722258,40.7713788187939,40.77135428227739,40.77132529262823,40.77133695751304,40.7711960049097,40.77145073826727,40.77144070980667,40.77144919069789,40.7714681460756,40.77148560593768,40.77151604240567,40.77160733994432,40.77164524947347,40.77165877492352,40.77254286890211,40.77281748122878,40.77192954753039,40.7723771265885,40.77280267502928,40.77312897504551,40.77327539109319,40.77252478194361,40.7725264851383,40.77248719102147,40.77293178785084,40.77295574416407,40.77295519487691,40.77294465390911,40.77288284612953,40.77292405852363,40.77290187017444,40.77297002866411,40.77299380156693,40.77303955110158,40.77312144027041,40.77315624399198,40.77348119657636,40.77341413866602,40.77338847503933,40.77335803492454,40.77329715319004,40.77378979139785,40.77385235618426,40.77381631601527,40.77381737760125,40.77388688661026,40.77391335462103,40.77391398490332,40.77391671365438,40.77395180529928,40.77396032396157,40.7739869543517,40.77408618643781,40.77406889580338,40.77387073139447,40.77317951096708,40.77326952907246,40.77338176688286,40.77348399450796,40.77356215215571,40.77363229021256,40.77371444646876,40.7737705496785,40.7738026124241,40.77392688015482,40.7749740560371,40.77495601635958,40.77500211044003,40.77502415955197,40.77501814039087,40.77511603385874,40.77549759869503,40.77550907505354,40.77548221102633,40.77546890095871,40.77550189976682,40.77555717992225,40.77598397082155,40.77607334073559,40.77687956054548,40.77756687876315,40.77756055024275,40.77758506567924,40.7779964575168,40.77862756000917,40.77925239865176,40.77925278678202,40.77928752401596,40.77940759766223,40.7796929229116,40.77971373825319,40.77969789571215,40.77972343927125,40.77973770647215,40.77972504438997,40.77969814668357,40.77967756865823,40.77967124471433,40.77968075267084,40.77969659276877,40.77970767719585,40.77969976970497,40.77968236171398,40.7796617943952,40.77966497255312,40.77966813912406,40.77967606441192,40.77967132868682,40.77964600764408,40.77963968425453,40.77965235262594,40.77966977560666,40.77967136758728,40.77965078301926,40.77963020920907,40.77963179604158,40.779585882835,40.77957482093497,40.77975528028723,40.77987889853291,40.7799561784406,40.78005929251639,40.78009603764939,40.78012236626782,40.78022609434385,40.78098107404602,40.78123314421575,40.78122548254225,40.78136567132739,40.78137928127419,40.78140179694508,40.7815859608514,40.78160287830547,40.78165093500182,40.78163418881063,40.78177098703173,40.78183347821599,40.78189205133494,40.78391657371892,40.78423876424562,40.78443891187755,40.78514186259524,40.78536070057564,40.78606845225888,40.78591921908161,40.78518963882032,40.78521031850172,40.78595120288745,40.78612188244851,40.78623900133132,40.78624070602679,40.78622896423692,40.78605822569814,40.78541394218483,40.78592193511064,40.78596655219797,40.78601333415833,40.7860305018166,40.78597620551177,40.78597257215096,40.78596313985604,40.78597862095025,40.78603585813698,40.78622212391986,40.78617599466898,40.78619627485883,40.78630978621333,40.7862901501469,40.78624291199401,40.78621964571547,40.78604766921298,40.78603955488387,40.78602099926737,40.78606029702016,40.78601423769841,40.78613072065119,40.78653474180816,40.78657008285493,40.78642652901978,40.78645284788053,40.78648711346413,40.78661686535727,40.78658761839311,40.78658601635003,40.78791528131291,40.78985478127541,40.79051658043272,40.79122824600533,40.79137550943322,40.7918678937827,40.79245681262519,40.79259428309692,40.79299376588594,40.79311352566668,40.79417763216352,40.79558676046106,40.7962846297721,40.79763134839337,40.79827321069286,40.79825402100805,40.79802885748954,40.79793007772613,40.7978885523112,40.79784774355748,40.79777972909964,40.79771335006335,40.79734378887695,40.79725869615883,40.79717273830175,40.79708644391278,40.7970003436665,40.79691496714641,40.79683083930124,40.79674847747629,40.79666838815485,40.79656300696694,40.79639667951302,40.79616710909522,40.79601761210657,40.7952520260827,40.79457931138681,40.79395267709817,40.79332480515755,40.79276599059227,40.79272104552845,40.79209412672481,40.79205057194164,40.79149820306067,40.79137651221951,40.79134541673072,40.79029580166992,40.7909363093627,40.79113312381317,40.79121731471288,40.79156090265057,40.79218452504701,40.79285856855645,40.79260035944105,40.79166402679902,40.79236204502794,40.7928799013058,40.79300902804499,40.79367857327849,40.7938678763283,40.79401618149655,40.79423723569166,40.79485206056086,40.7954792705639,40.79611082718436,40.79673864454806,40.7970559756555,40.79736846946253,40.79803810789733,40.79871852602333,40.7993522339281,40.79997702615466,40.80036505351127,40.80058254095498,40.80051527243921,40.79946642641659,40.79944050069729,40.79942119889439,40.79940664661778,40.79837209207192,40.79826974269281,40.79824249401055,40.798209771248,40.79760311767065,40.7970970016014,40.79687199990531,40.79660638416064,40.79621698538102,40.79558773150458,40.79495959137657,40.79428503532208]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"navy","weight":2,"opacity":0.5,"fill":true,"fillColor":"lightblue","fillOpacity":0.3,"smoothFactor":1,"noClip":false},null,null,"District 6",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[[],[],4,null,null,{"interactive":true,"className":"","stroke":false,"color":[],"weight":5,"opacity":0.5,"fill":true,"fillColor":[],"fillOpacity":0.8},null,null,"<b>Species:<\/b> <br><b>Health:<\/b> <br><b>Status:<\/b> ",null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["red","orange","yellow","lightgreen","darkgreen"],"labels":["Dead","Poor","Fair","Good","Excellent"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"unknown","title":"Tree Health","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[40.76239607235233,40.80058254095498],"lng":[-73.99707328169315,-73.94923327016367]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/rahicodes\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>